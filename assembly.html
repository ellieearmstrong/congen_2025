<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ConGen2025 Assembly Workshop – Assembly</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent: #2563eb;
      --nav-bg: rgba(17, 24, 39, 0.95);
      --card-bg: rgba(249, 250, 251, 0.96);
      --text-main: #111827;
      --text-muted: #4b5563;
      --border-subtle: #e5e7eb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background:
        linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)),
        url("https://cdn.pixabay.com/photo/2019/11/26/18/05/montana-4652867_1280.jpg")
        no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
    }

    /* NAVBAR */
    .navbar-shell { padding: 0.75rem 1rem 0; }
    .navbar {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0.6rem 1.2rem;
      border-radius: 999px;
      background: var(--nav-bg);
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      border: 1px solid rgba(55, 65, 81, 0.9);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      color: #e5e7eb;
      position: relative;
      z-index: 10;
      flex-wrap: wrap;
    }

    .nav-link,
    .nav-dropdown > a {
      color: #e5e7eb;
      text-decoration: none;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
      transition: background 0.15s ease;
    }

    .nav-link:hover, .nav-dropdown > a:hover {
      background: rgba(31, 41, 55, 0.9);
    }

    .nav-link.active, .nav-dropdown > a.active {
      background: #f9fafb;
      color: #111827;
      font-weight: 600;
    }

    /* DROPDOWN */
    .nav-dropdown { position: relative; }
    .dropdown-caret { font-size: 0.75rem; }
    .dropdown-menu {
      position: absolute;
      top: 100%; left: 0;
      background: #f9fafb;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      min-width: 170px;
      padding: 0.25rem 0;
      box-shadow: 0 18px 50px rgba(0,0,0,0.4);
      display: none;
      z-index: 20;
    }
    .dropdown-menu a {
      display: block;
      padding: 0.45rem 0.9rem;
      font-size: 0.9rem;
      color: #374151;
      text-decoration: none;
    }
    .dropdown-menu a:hover { background: #e5e7eb; }
    .nav-dropdown:hover .dropdown-menu { display: block; }

    /* PAGE SHELL */
    .page {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 1rem;
      padding-bottom: 2.5rem;
    }

    .page-inner { width: 100%; max-width: 1000px; }

    .card {
      margin-top: 1.25rem;
      background: var(--card-bg);
      border-radius: 18px;
      padding: 1.75rem 2rem 2rem;
      box-shadow: 0 22px 50px rgba(0,0,0,0.45);
      border: 1px solid #e5e7eb;
    }

    .page-header h1 {
      margin: 0 0 0.5rem;
      font-size: clamp(1.8rem, 3vw, 2.2rem);
    }

    .page-header p {
      margin: 0.25rem 0;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    /* CONTENTS BOX */
    .page-contents {
      margin: 1.5rem 0 1.25rem;
      background: #f3f4f6;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 0.85rem 1rem;
      font-size: 0.9rem;
    }

    .page-contents-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #6b7280;
      margin-bottom: 0.3rem;
    }

    .section { margin-top: 1.5rem; }
    .section h2 { margin-top: 0; margin-bottom: 0.5rem; font-size: 1.2rem; }
    .section h3 { margin-top: 1rem; margin-bottom: 0.4rem; font-size: 1.05rem; }
    .section p { margin: 0.35rem 0; color: var(--text-muted); }

    /* CODE BLOCKS */
    .code-block-green {
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      display: inline-block;
      font-family: monospace;
      white-space: pre-wrap;
      color: #065f46;
      margin: 1rem 0;
    }

    .code-block-red {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      border-radius: 12px;
      padding: 1rem 1.25rem;
      margin: 1.25rem auto;
      display: block;
      width: fit-content;
      max-width: 100%;
      font-family: monospace;
      color: #991b1b;
      white-space: pre-wrap;
    }

    .code-block-blue {
      background: #add7f7;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      display: inline-block;
      font-family: monospace;
      white-space: pre-wrap;
    }

    /* TABLES */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.75rem 0 1rem;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 0.4rem 0.55rem;
      text-align: left;
    }
    th { background: #f3f4f6; font-weight: 600; }

    /* FIGURES */
    figure {
      margin: 1rem 0;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      background: white;
    }

    figure img { width: 100%; display: block; }
    figcaption { padding: 0.5rem 0.8rem; background: #f9fafb; font-size: 0.85rem; }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <div class="navbar-shell">
    <nav class="navbar">
      <a href="intro.html" class="nav-link">Intro</a>

      <div class="nav-dropdown">
        <a href="workshop.html" class="active">
          Workshop <span class="dropdown-caret">▾</span>
        </a>
        <div class="dropdown-menu">
          <a href="workshop.html#start">Start</a>
          <a href="reads.html">Reads</a>
          <a href="assembly.html" class="active">Assembly</a>
        </div>
      </div>

      <a href="terminology.html" class="nav-link">Terminology</a>
      <a href="programs.html" class="nav-link">Programs</a>
      <a href="links.html" class="nav-link">Links</a>
    </nav>
  </div>

  <!-- MAIN CONTENT -->
  <main class="page">
    <div class="page-inner">
      <section class="card">

        <!-- HEADER -->
        <header class="page-header">
          <h1>Genome assembly</h1>
          <p>This module walks through genome assembly using short and long reads, followed by quality and completeness assessment.</p>
        </header>

        <!-- PAGE CONTENTS -->
        <section class="page-contents">
          <div class="page-contents-title">Page contents</div>
          <ul>
            <li><a href="#intro">Introduction</a></li>
            <li><a href="#spades">Short-read assembly with SPAdes</a></li>
            <li><a href="#flye">Long-read assembly with Flye</a></li>
            <li><a href="#hifiasm">Long-read assembly with Hifiasm</a></li>
            <li><a href="#assembly-quality">Assembly quality with N50</a></li>
            <li><a href="#compleasm">Assembly completeness with compleasm</a></li>
            <li><a href="#hic">Interpreting Hi-C data</a></li>
            <li><a href="#further">Further analyses</a></li>
          </ul>
        </section>

        <!-- INTRO -->
        <section class="section" id="intro">
          <h2>Introduction</h2>

          <p>
            A genome assembly reconstructs chromosomes from sequencing reads. Short-read assemblers often use <strong>de Bruijn graphs</strong>, while long-read assemblers rely on <strong>overlap-based</strong> approaches. Both aim to resolve repeats, heterozygosity, and complex genomic structure.
          </p>

          <figure>
            <img src="Fig3.1.png" alt="Cartoon of assembly graph" />
            <figcaption>Figure 3.1 – Cartoon of the assembly process.</figcaption>
          </figure>

          <p>
            In this module we examine SPAdes (short reads), Flye (long reads), and Hifiasm (long accurate reads), then evaluate assembly contiguity and completeness.
          </p>
        </section>

        <!-- SPADES -->
        <section class="section" id="spades">
          <h2>Short-read assembly with SPAdes</h2>

          <p>We’ll assemble Illumina paired-end reads using SPAdes:</p>

          <div class="code-block-green">
spades.py \
  -1 T_deckeni_reads/illumina/SRR31758803-chr2_1.fastq.gz \
  -2 T_deckeni_reads/illumina/SRR31758803-chr2_2.fastq.gz \
  -o assemblies/spades-illumina-chr2-k77/ \
  -k 77 \
  -t 4 \
  -m 8 \
  --isolate
          </div>

          <table>
            <thead><tr><th>Parameter</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>-1</code>, <code>-2</code></td><td>Paired-end FASTQ files.</td></tr>
              <tr><td><code>-o</code></td><td>Output directory.</td></tr>
              <tr><td><code>-k</code></td><td>k-mer size.</td></tr>
              <tr><td><code>-t</code></td><td>Threads.</td></tr>
              <tr><td><code>-m</code></td><td>Max memory (GB).</td></tr>
              <tr><td><code>--isolate</code></td><td>Improves assembly on high-coverage datasets.</td></tr>
            </tbody>
          </table>

          <figure>
            <img src="Fig3.2.png" alt="SPAdes assembly graph" />
            <figcaption>Figure 3.2 – de Bruijn graph compaction the assembler performs.</figcaption>
          </figure>
        </section>

        <!-- FLYE -->
        <section class="section" id="flye">
          <h2>Long-read assembly with Flye</h2>

          <p>
            <a href="https://github.com/mikolmogorov/Flye" target="_blank">Flye</a> is built for noisy long reads such as Nanopore and CLR data. It constructs repeat graphs directly and handles complex long-read error profiles well.
          </p>

          <div class="code-block-red">
flye \
  --pacbio-hifi T_deckeni_reads/pacbio/pacbio_Tdeckeni_chr2_subsample.fastq.gz \
  --genome-size 0.08g \
  --out-dir assemblies/flye-pacbio-chr2 \
  --threads 4
          </div>

          <p>Flye outputs <code>assembly.fasta</code>, graph files, and log files.</p>
        </section>

        <!-- HIFIASM -->
        <section class="section" id="hifiasm">
          <h2>Long-read assembly with Hifiasm</h2>

          <p>
            Hifiasm is optimized for PacBio HiFi reads and often produces phased haplotypes.
          </p>

          <div class="code-block-red">
hifiasm \
  -o assemblies/hifiasm-pacbio-chr2 \
  -t 4 \
  T_deckeni_reads/pacbio/pacbio_Tdeckeni_chr2_subsample.fastq.gz
          </div>
        </section>

        <!-- ASSEMBLY QUALITY -->
        <section class="section" id="assembly-quality">
          <h2>Assembly quality with N50</h2>

          <p>
            Genome assemblies vary in contiguity due to repeats, heterozygosity, and structural complexity. Several metrics summarize contiguity:
          </p>

          <table>
            <thead><tr><th>Statistic</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td>Total assembly size</td><td>Sum of all bases in all contigs/scaffolds.</td></tr>
              <tr><td>Number of contigs/scaffolds</td><td>Lower counts indicate greater contiguity.</td></tr>
              <tr><td>N50</td><td>Length at which half of the assembly is in contigs/scaffolds ≥ this size.</td></tr>
              <tr><td>L90</td><td>Number of contigs/scaffolds required to cover 90% of assembly.</td></tr>
              <tr><td>NG50</td><td>N50 computed relative to expected genome size.</td></tr>
              <tr><td>Number of Ns</td><td>Bases inserted to span joins between contigs.</td></tr>
            </tbody>
          </table>

          <p>
            The following N50 diagram from Molecular Ecologist illustrates the concept:
          </p>

          <figure>
            <img src="Fig3.3.png" alt="N50 figure" />
            <figcaption>Figure 3.3 – Scaffold N50 concept.</figcaption>
          </figure>

          <p>
            Assemblathon (2013) provides useful scripts for summarizing genome assembly statistics.
          </p>

          <div class="code-block-green">
perl /usr/bin/assemblathon_stats.pl \
  expected-outputs/assemblies/Tdeckeni_hap2_yahs.out_scaffolds_final.fa \
  > quality-control/Tdeckeni_hap2_yahs.out_scaffolds_final-assemblathon.txt
          </div>

          <p>Then view the output:</p>

          <div class="code-block-green">
less -S quality-control/Tdeckeni_hap2_yahs.out_scaffolds_final-assemblathon.txt
          </div>

          <div class="code-block-blue">
---------------- Information for assembly 'expected_outputs/assemblies/Tdeckeni_hap2_y


                                         Number of scaffolds         81
                                     Total size of scaffolds 1030508849
                                            Longest scaffold  130958238
                                           Shortest scaffold       5000
                                 Number of scaffolds > 1K nt         81 100.0%
                                Number of scaffolds > 10K nt         80  98.8%
                               Number of scaffolds > 100K nt         52  64.2%
                                 Number of scaffolds > 1M nt         36  44.4%
                                Number of scaffolds > 10M nt         28  34.6%
                                          Mean scaffold size   12722331
                                        Median scaffold size     356156
                                         N50 scaffold length   48768445
                                          L50 scaffold count          8
                                                 scaffold %A      27.68
                                                 scaffold %C      22.28
                                                 scaffold %G      22.35
                                                 scaffold %T      27.69
                                                 scaffold %N       0.00
                                         scaffold %non-ACGTN       0.00
                             Number of scaffold non-ACGTN nt          0

                Percentage of assembly in scaffolded contigs      51.9%
              Percentage of assembly in unscaffolded contigs      48.1%
                      Average number of contigs per scaffold        1.6
          </div>

        </section>

        <!-- COMPLEASM -->
        <section class="section" id="compleasm">
          <h2>Assembly completeness with compleasm</h2>

          <p>
            Compleasm (based on BUSCO) evaluates genome completeness using universal single-copy orthologs.
            For birds, the <strong>aves</strong> lineage is appropriate.
          </p>

          <div class="code-block-red">
compleasm run \
  -a expected-outputs/assemblies/Tdeckeni_hap2_yahs.out_scaffolds_final.fa \
  -L mb_downloads \
  -l aves \
  -o quality-control/Tdeckeni_hap2_yahs.out_scaffolds_final_aves \
  -t 4
          </div>

          <figure>
            <img src="Fig3.4.png" alt="Compleasm results" />
            <figcaption>Fig. 3.4 – Compleasm comparison of <em>T. deckeni</em> assemblies.</figcaption>
          </figure>
        </section>

        <!-- HI-C -->
        <section class="section" id="hic">
          <h2>Interpreting Hi-C data</h2>

          <p>
            Hi-C provides chromosome-scale linkage by measuring physical proximity between genomic loci.
            Properly scaffolded chromosomes show a strong diagonal line on the contact map.
          </p>

          <figure>
            <img src="cis_trans_hic.jpg" alt="Hi-C contact map" />
            <figcaption>Fig. 3.7 – Example Hi-C contact matrix.</figcaption>
          </figure>

          <h3>Assembly issues visible in Hi-C</h3>
          <ul>
            <li><strong>Breaks</strong> → discontinuities in diagonal</li>
            <li><strong>Inversions</strong> → mirrored X-shaped signatures</li>
            <li><strong>Misjoins</strong> → abrupt loss of contact support</li>
          </ul>

          <h3>Example: Inversion</h3>
          <figure>
            <img src="inversion_mosquito_example_Lukyanchikova2025.jpg" alt="Hi-C inversion" />
            <figcaption>Fig. 3.6 – Hi-C signature of an inversion.</figcaption>
          </figure>

          <h3>Example: Misjoin</h3>
          <figure>
            <img src="Fig3.7.png" alt="Hi-C misjoin" />
            <figcaption>Fig. 3.7: Loss of contact support can reveal misjoins.</figcaption>
          </figure>

          <h3>Tools for Hi-C scaffolding</h3>
          <table>
            <thead><tr><th>Tool</th><th>Purpose</th><th>Link</th></tr></thead>
            <tbody>
              <tr><td>YaHS</td><td>Fast, accurate Hi-C scaffolding</td><td><a href="https://github.com/c-zhou/yahs">GitHub</a></td></tr>
              <tr><td>Juicebox</td><td>Manual Hi-C visualization/editing</td><td><a href="https://github.com/aidenlab/Juicebox">GitHub</a></td></tr>
              <tr><td>3D-DNA</td><td>Automated scaffolding + misjoin correction</td><td><a href="https://github.com/aidenlab/3d-dna">GitHub</a></td></tr>
              <tr><td>hicExplorer</td><td>Hi-C plotting toolkit</td><td><a href="https://hicexplorer.readthedocs.io">Docs</a></td></tr>
              <tr><td>HiGlass/Cooler</td><td>Interactive web visualization</td><td><a href="https://higlass.io">Website</a></td></tr>
            </tbody>
          </table>

        </section>

        <!-- FURTHER ANALYSES -->
        <section class="section" id="further">
          <h2>Further analyses</h2>
          <ul>
            <li>Genome annotation</li>
            <li>Variant calling</li>
            <li>Comparative genomics & synteny</li>
            <li>Demographic inference</li>
            <li>Conservation genomics (ROH, SVs, mutational load)</li>
          </ul>

          <p>
            A high-quality genome assembly forms the foundation for all downstream evolutionary,
            functional, and conservation analyses.
          </p>
        </section>

      </section>
    </div>
  </main>

</body>
</html>
